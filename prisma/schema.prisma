// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enum定義
enum Reason {
  PERFORMERSNS
  FRIEND
  TWITTER
  FACEBOOK
  INSTAGRAM
  THREADS
  WEBSITE
  OTHER
}

enum Status {
  VACANT
  FULL
}

enum Type {
  S
  A
  C
  D
}

// ログインテーブル
model User {
  id          Int       @id @default(autoincrement())
  name        String
  email       String    @unique
  password    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

//ライブ登録テーブル
model LiveInfo {
  id            Int       @id @default(autoincrement())
  day           Int
  openTime      Int
  liveName      String
  chargePrice   Int
  ticketQuota   Int
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // リレーション定義
  reservations      Reservation[]
  fellowPerformers   FellowPerformer[]
  performers        Performer[]
}

//共演者テーブル
model FellowPerformer {
  id            Int       @id @default(autoincrement())
  liveId        Int
  name          String
  role          String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // リレーション定義
  live             LiveInfo  @relation(fields: [liveId], references: [id], onDelete: Cascade)
}

//出演者テーブル
model Performer {
  id            Int       @id @default(autoincrement())
  liveId        Int
  name          String
  role          String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // リレーション定義
  live             LiveInfo  @relation(fields: [liveId], references: [id], onDelete: Cascade)
}


//予約リストテーブル
model Reservation {
  id               Int      @id @default(autoincrement())
  liveId           Int
  customerName     String
  reservationDay   Int
  method           String
  reservationName  String
  numberOfPeople   Int
  drink            Int?
  addP             Int?
  remarks          String?
  reason           Reason?
  staffId          Int
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // リレーション定義
  reservationSeats   ReservationSeat[]
  reservationMenus   ReservationMenu[]

  live             LiveInfo  @relation(fields: [liveId], references: [id], onDelete: Cascade)
  staff            Staff     @relation(fields: [staffId], references: [staffId], onDelete: Cascade)
}


//座席テーブル
model Seat {
  id            Int         @id @default(autoincrement())
  seatName      String
  capacity      Int
  status        Status      @default(VACANT)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // リレーション定義
  reservationSeats    ReservationSeat[]
}

//予約リストと座席を多対多で紐づける中間テーブル
model ReservationSeat {
  id              Int       @id @default(autoincrement())
  reservationId   Int
  seatId          Int
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // リレーション定義
  reservation     Reservation   @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  seat            Seat          @relation(fields: [seatId], references: [id], onDelete: Cascade)

  //重複防止
  @@unique([reservationId,seatId])
}

//メニューテーブル
model Menu {
  id              Int       @id @default(autoincrement())
  menuId          Int?
  name            String
  type            Type
  price           Int
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // リレーション定義
  reservationMenus   ReservationMenu[]
}

//予約リストとメニューを多対多で紐づける中間テーブル
model ReservationMenu {
  id              Int       @id @default(autoincrement())
  reservationId   Int
  menuId          Int
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // リレーション定義
  reservation     Reservation   @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  menu            Menu          @relation(fields: [menuId], references: [id], onDelete: Cascade)

  //重複防止
  @@unique([reservationId, menuId])
}

//受付者テーブル
model Staff {
  id              Int       @id @default(autoincrement())
  staffId         Int       @unique
  staffName       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // リレーション定義
  reservations      Reservation[]
}